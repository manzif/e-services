<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>E-services | Services</title>
    <link rel="stylesheet" href="../css/style.css" />
  </head>
  <body>
    <header>
      <div class="container">
        <div id="branding">
          <h1><span class="highlight">E</span>-Service</h1>
        </div>
        <nav>
          <ul>
            <li><a href="../index.html">Home</a></li>
            <li class="current"><a href="services.html">SERvices</a></li>
            <li><a href="./post.html">Post A Service</a></li>
            <li><a href="./about.html">About</a></li>
          </ul>
        </nav>
      </div>
    </header>
    <section id="subscription">
      <div class="container">
        <div>
          <h1>Create account to our E-services</h1>
          <form id="signup-form">
            <div id="error-msg2" class="error-msg"></div>
            <div id="success-msg2" class="success-msg"></div>
            <input type="text" placeholder="Enter Your Names" id="name" />
            <input type="email" placeholder="Enter Email ..."  id="email"/>
            <button type="submit" class="button_1">Save</button>
          </form>
        </div>
      </div>
    </section>
    <section id="main">
      <div class="container">
        <article id="main-col1">
          <h1 class="page-title">Services</h1>
          <ul id="host"></ul>
        </article>
      </div>
    </section>
    <footer>
      <a href="login.html">Administration</a>
      <p>E-services, copyright &copy; 2019</p>
    </footer>

    <script>
      document.getElementById('signup-form').addEventListener('submit', signup);

      function signup(e) {
        e.preventDefault();

        let fullname = document.getElementById('name').value;
        let email = document.getElementById('email').value;
        let error_msg = document.getElementById('error-msg2');
        let success_msg = document.getElementById('success-msg2');

        fetch('https://e-services-manzi.herokuapp.com/api/users', {
          method: 'POST',
          headers: {
            Accept: 'application/json, text/plain, */*',
            'Content-type': 'application/json'
          },
          body: JSON.stringify({
            fullname: fullname,
            email: email
          })
        })
          .then(res => res.json())
          .then(data => {
            if (data.status !== 201) {
              error_msg.style.display = 'block';
              error_msg.innerHTML = data.error;
            } else {
              error_msg.style.display = 'none';
              success_msg.style.display = 'block';
              success_msg.innerHTML = data.message;
              document.getElementById('name').value = '';
              document.getElementById('email').value = '';
            }
            console.log(data);
          });
      }
    </script>
    <script>
      let service = document.getElementById('host');
      fetch('https://e-services-manzi.herokuapp.com/api/services', {
        method: 'GET',
        headers: {
          Accept: 'application/json, text/plain, */*',
          'Content-type': 'application/json'
        }
      })
        .then(res => res.json())
        .then(data => {
          console.log(data);
          data.forEach(element => {
            
            service.innerHTML += `<li>
                                    <h3><a href="./teach.html?id=${
                                      element.id
                                    }">${element.title}</a></h3>
                                    <p>${element.description.substring(0,187) + '...'}</p>
                                </li>`;
          });
        });
    </script>
  </body>
</html>
