<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>E-services | Admin</title>
    <link rel="stylesheet" href="../css/style.css" />
  </head>
  <body>
    <header>
      <div class="container">
        <div id="branding">
          <h1><span class="highlight">Admini</span>stration</h1>
        </div>
        <nav>
          <ul>
            <li><a href="admin.html">Admin</a></li>
            <li class="current"><a href="post.html">Post</a></li>
            <li><a href="./service.html">Services</a></li>
            <li><a href="users.html">Users</a></li>
            <li><a href="../index.html">Logout</a></li>
          </ul>
        </nav>
      </div>
    </header>
    <section id="post">
      <div class="container">
        <div class="post">
          <h3>Post a New Service</h3>
          <div id="error-msg" class="error-msg"></div>
          <div id="success-msg" class="success-msg"></div>
          <form id="post1" name="posts">
            <div>
              <input
                type="text"
                placeholder="Enter Service Title..."
                id="title"
              />
            </div>
            <div>
              <input
                type="text"
                placeholder="Enter Company Name..."
                id="company"
              />
            </div>
            <div class="post2">
              <input type="file" id="image" name="image" />
            </div>
            <div>
              <textarea id="description"></textarea>
            </div>
            <div>
              <button type="submit" class="button_1">Save</button>
            </div>
          </form>
        </div>
      </div>
    </section>
    <footer>
      <a href="admin.html">Administration</a>
      <p>E-services, copyright &copy; 2019</p>
    </footer>

    <script>
      document.getElementById('post1').addEventListener('submit', login);

      function login(e) {
        e.preventDefault();

        let title = document.getElementById('title').value;
        let company = document.getElementById('company').value;
        let description = document.getElementById('description').value;
        let image = document.forms['posts']['image'].files[0];
        let error_msg = document.getElementById('error-msg');
        let success_msg = document.getElementById('success-msg');

        const formData = new FormData();
        formData.append('title', title);
        formData.append('company', company);
        formData.append('description', description);
        formData.append('image', image);

        fetch('http://localhost:5000/api/services', {
          method: 'POST',
          headers: {
            Accept: 'application/json, text/plain, */*'
            // 'Content-type': 'multipart/form-data'
          },
          body: formData
        })
          .then(res => res.json())
          .then(data => {
            if (data.status !== 201) {
              error_msg.style.display = 'block';
              error_msg.innerHTML = data.error;
            } else {
              success_msg.style.display = 'block';
              success_msg.innerHTML = data.message;
            }
            console.log(data);
          });
      }
    </script>
  </body>
</html>
